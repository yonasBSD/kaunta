{{define "page-subtitle"}}Campaign Analytics{{end}} {{define "navigation"}}
<a
  href="/dashboard"
  class="btn btn-sm btn-ghost glass transition-standard"
  title="Back to Dashboard"
>
  <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M10 19l-7-7m0 0l7-7m-7 7h18"
    ></path>
  </svg>
  Dashboard
</a>
{{end}} {{define "website-selector"}}
<div id="website-selector-container" data-show="$websites.length > 0">
  <!-- Selector populated via SSE -->
</div>
{{end}} {{define "date-controls"}}<!-- Campaigns page doesn't need date controls -->{{end}} {{define
"filters"}}<!-- Campaigns page doesn't need filters -->{{end}} {{define "header-buttons"}}<!-- Campaigns page doesn't need header buttons -->{{end}}
{{define "page-scripts"}}
<script src="/assets/js/campaigns.js?v={{.Version}}"></script>
{{end}} {{define "content"}}
<div
  id="campaigns-container"
  data-signals:websitesLoading="true"
  data-signals:websitesError="false"
  data-signals:websites="[]"
  data-signals:selectedWebsite="(() => { const value = localStorage.getItem('kaunta_website'); return value && value !== 'undefined' && value !== 'null' ? value : ''; })()"
  data-signals:loading="{
    source: false,
    medium: false,
    campaign: false,
    term: false,
    content: false
  }"
  data-signals:sort="{
    source: { column: 'count', direction: 'desc' },
    medium: { column: 'count', direction: 'desc' },
    campaign: { column: 'count', direction: 'desc' },
    term: { column: 'count', direction: 'desc' },
    content: { column: 'count', direction: 'desc' }
  }"
  data-signals:lastCampaignWebsite="''"
  data-init="@get('/api/dashboard/campaigns-init')"
>
  <!-- Main content when we have websites and selection -->
  <div
    data-show="!$websitesLoading && !$websitesError && $selectedWebsite && $websites.length > 0"
    data-class:hidden="!$selectedWebsite || $websites.length === 0"
  >
    <div
      class="utm-grid"
      style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 24px"
    >
      <!-- UTM Source -->
      <div id="utm-source-card" class="section glass card">
        <div class="section-header">
          <h2>
            <svg class="icon-lg" fill="currentColor" viewBox="0 0 24 24">
              <path
                d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 919-9"
              ></path>
            </svg>
            Source
          </h2>
        </div>
        <div data-show="$loading.source" class="loading">
          <div class="spinner"></div>
          <div>Loading UTM source data…</div>
        </div>
        <div id="utm-source-content">
          <!-- patched here: table or empty state -->
        </div>
      </div>

      <!-- UTM Medium -->
      <div id="utm-medium-card" class="section glass card">
        <div class="section-header">
          <h2>
            <svg class="icon-lg" fill="currentColor" viewBox="0 0 24 24">
              <path
                d="M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"
              ></path>
            </svg>
            Medium
          </h2>
        </div>
        <div data-show="$loading.medium" class="loading">
          <div class="spinner"></div>
          <div>Loading UTM medium data…</div>
        </div>
        <div id="utm-medium-content">
          <!-- patched here -->
        </div>
      </div>

      <!-- UTM Campaign -->
      <div id="utm-campaign-card" class="section glass card">
        <div class="section-header">
          <h2>
            <svg class="icon-lg" fill="currentColor" viewBox="0 0 24 24">
              <path
                d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"
              ></path>
            </svg>
            Campaign
          </h2>
        </div>
        <div data-show="$loading.campaign" class="loading">
          <div class="spinner"></div>
          <div>Loading UTM campaign data…</div>
        </div>
        <div id="utm-campaign-content">
          <!-- patched here -->
        </div>
      </div>

      <!-- UTM Term -->
      <div id="utm-term-card" class="section glass card">
        <div class="section-header">
          <h2>
            <svg class="icon-lg" fill="currentColor" viewBox="0 0 24 24">
              <path
                d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"
              ></path>
            </svg>
            Term
          </h2>
        </div>
        <div data-show="$loading.term" class="loading">
          <div class="spinner"></div>
          <div>Loading UTM term data…</div>
        </div>
        <div id="utm-term-content">
          <!-- patched here -->
        </div>
      </div>

      <!-- UTM Content -->
      <div id="utm-content-card" class="section glass card">
        <div class="section-header">
          <h2>
            <svg class="icon-lg" fill="currentColor" viewBox="0 0 24 24">
              <path
                d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"
              ></path>
            </svg>
            Content
          </h2>
        </div>
        <div data-show="$loading.content" class="loading">
          <div class="spinner"></div>
          <div>Loading UTM content data…</div>
        </div>
        <div id="utm-content-content">
          <!-- patched here -->
        </div>
      </div>
    </div>
  </div>

  <!-- No website selected -->
  <div
    data-show="!$websitesLoading && !$websitesError && !$selectedWebsite && $websites.length > 0"
    class="empty-state"
    style="margin-top: 100px"
  >
    <div class="empty-state-icon">...</div>
    <div class="empty-state-title">Select a Website</div>
    <div class="empty-state-text">
      Choose a website from the dropdown above to view campaign data
    </div>
  </div>

  <!-- No websites at all -->
  <div
    data-show="!$websitesLoading && !$websitesError && $websites.length === 0"
    class="empty-state"
    style="margin-top: 100px"
  >
    <div class="empty-state-icon">[~]</div>
    <div class="empty-state-title">No websites found</div>
    <div class="empty-state-text">Add a website in Kaunta to get started.</div>
  </div>

  <!-- Load error -->
  <div
    data-show="!$websitesLoading && $websitesError"
    class="empty-state"
    style="margin-top: 100px"
  >
    <div class="empty-state-icon">[!]</div>
    <div class="empty-state-title">Unable to load websites</div>
    <div
      class="empty-state-text"
      data-text="$websitesError || 'Check the server logs and try again.'"
    ></div>
  </div>

  <!-- Auto trigger when website changes -->
  <div
    aria-hidden="true"
    style="display: none"
    data-effect="
      if ($selectedWebsite) {
        if ($selectedWebsite !== $lastCampaignWebsite) {
          $lastCampaignWebsite = $selectedWebsite;
          @get('/api/dashboard/campaigns?website_id=' + encodeURIComponent($selectedWebsite));
        }
      }
    "
  ></div>
</div>

<style>
  .empty-state-mini {
    text-align: center;
    padding: 32px 16px;
    color: var(--text-tertiary);
  }
  .empty-state-mini > div:first-child {
    font-size: 32px;
    margin-bottom: 8px;
    opacity: 0.5;
  }
  .sortable-header:hover {
    background: var(--bg-accent);
  }
  .loading {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    padding: 32px 16px;
    color: var(--text-secondary);
  }
</style>
{{end}}
